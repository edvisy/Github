#if __DESIGNER_DATA
#error Do not define __DESIGNER_DATA.
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<om:MetaModel MajorVersion="1" MinorVersion="3" Core="2b131234-7959-458d-834f-2dc0769ce683" ScheduleModel="66366196-361d-448d-976f-cab5e87496d2" xmlns:om="http://schemas.microsoft.com/BizTalk/2003/DesignerData">
    <om:Element Type="Module" OID="943c76a5-9f76-4f39-8059-0c2cb903d3c5" LowerBound="1.1" HigherBound="404.1">
        <om:Property Name="ReportToAnalyst" Value="True" />
        <om:Property Name="Name" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations" />
        <om:Property Name="Signal" Value="False" />
        <om:Element Type="PortType" OID="2b08208d-64b7-4af4-87f9-d206b15a0767" ParentLink="Module_PortType" LowerBound="4.1" HigherBound="11.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="PortType_InAccountXmlMsg" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="a910e94b-2c25-4be5-b879-83839a39b59d" ParentLink="PortType_OperationDeclaration" LowerBound="6.1" HigherBound="10.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Operation_InAccountXmlMsg" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="9c6a5864-97e4-459f-baca-b271a8faa500" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="8.13" HigherBound="8.35">
                    <om:Property Name="Ref" Value="System.Xml.XmlDocument" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="PortType" OID="138899ef-d291-4c33-bd0f-85e4ba653223" ParentLink="Module_PortType" LowerBound="11.1" HigherBound="18.1">
            <om:Property Name="Synchronous" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="PortType_SendMailForAccount" />
            <om:Property Name="Signal" Value="False" />
            <om:Element Type="OperationDeclaration" OID="a09d67e3-545d-4500-a1e2-02ddc7fab9e1" ParentLink="PortType_OperationDeclaration" LowerBound="13.1" HigherBound="17.1">
                <om:Property Name="OperationType" Value="OneWay" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Operation_SendMailForAccount" />
                <om:Property Name="Signal" Value="True" />
                <om:Element Type="MessageRef" OID="70b05a45-1ec6-4e6d-82d8-cb0757b34629" ParentLink="OperationDeclaration_RequestMessageRef" LowerBound="15.13" HigherBound="15.31">
                    <om:Property Name="Ref" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.emailExceptionType" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="Request" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
            </om:Element>
        </om:Element>
        <om:Element Type="ServiceDeclaration" OID="a98a6d68-570a-4f7f-8783-79377b2b5e25" ParentLink="Module_ServiceDeclaration" LowerBound="18.1" HigherBound="403.1">
            <om:Property Name="InitializedTransactionType" Value="False" />
            <om:Property Name="IsInvokable" Value="False" />
            <om:Property Name="TypeModifier" Value="Internal" />
            <om:Property Name="ReportToAnalyst" Value="True" />
            <om:Property Name="Name" Value="SAPToSMAXAccount" />
            <om:Property Name="Signal" Value="True" />
            <om:Element Type="VariableDeclaration" OID="aa05a8f4-e867-4f2a-823a-acfaeb70815a" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="36.1" HigherBound="37.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Guid" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="token" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="c3df7b8d-1186-4822-90e9-02ddea9d68fa" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="37.1" HigherBound="38.1">
                <om:Property Name="UseDefaultConstructor" Value="True" />
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varXmlDoc" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="3106da41-8485-48dc-89da-32848e8c7647" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="38.1" HigherBound="39.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varDocNum" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="18da5e1e-6937-4d04-85a7-b96e6ed84a70" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="39.1" HigherBound="40.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varRetryLimit" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="0445209a-e5a6-4750-b5fe-5c5c1be1233a" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="40.1" HigherBound="41.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varRetryInterval" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="e32c72f9-681f-4e14-af1f-7c4245e17800" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="41.1" HigherBound="42.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Int32" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varRetryCount" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="f8b92383-1a6b-43ed-ae00-bd2391c98503" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="42.1" HigherBound="43.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varUpsertResp" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="130614c1-96bd-46d4-a0d5-56eb42003ef6" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="43.1" HigherBound="44.1">
                <om:Property Name="UseDefaultConstructor" Value="True" />
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varXmlDocForBAM" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="dce97cad-d22f-46f1-889e-b2e6f1beb024" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="44.1" HigherBound="45.1">
                <om:Property Name="UseDefaultConstructor" Value="True" />
                <om:Property Name="Type" Value="System.Exception" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varExpObj" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="cdca91d2-3ce2-4f1b-bfec-05b9169402ba" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="45.1" HigherBound="46.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varIsException" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="163988b0-fb9c-453b-9f4a-20dd224dd090" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="46.1" HigherBound="47.1">
                <om:Property Name="InitialValue" Value="false" />
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.Boolean" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varIsSoapExp" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="5adab677-7dc4-4fa5-a668-1ef74092b641" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="47.1" HigherBound="48.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varException" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="9ef15394-aee6-4a22-af83-17077d08219b" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="48.1" HigherBound="49.1">
                <om:Property Name="UseDefaultConstructor" Value="False" />
                <om:Property Name="Type" Value="System.String" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varErrorMsg" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="VariableDeclaration" OID="9ab020f5-3109-4832-83be-38dedca24f51" ParentLink="ServiceDeclaration_VariableDeclaration" LowerBound="49.1" HigherBound="50.1">
                <om:Property Name="UseDefaultConstructor" Value="True" />
                <om:Property Name="Type" Value="System.Text.StringBuilder" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="varBuilder_MsgBody" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="9c5c369a-c045-4e5c-8274-e2c8b859ffb2" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="29.1" HigherBound="30.1">
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgInXml" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="12d1191c-5fbf-4522-9c7a-7ceeabcebb93" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="30.1" HigherBound="31.1">
                <om:Property Name="Type" Value="Visy.Middleware.Common.Schemas.SAP.ZSM_DEBMAS.IDocOperation_DEBMAS07_ZSM_DEBMAS_740_3_Receive" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgDEBMAS07" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="ba3d7fb8-2aaa-47cf-9d88-6b78778731f9" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="31.1" HigherBound="32.1">
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Schemas.SforceServiceClient.upsertRequest" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgUpsertRequest" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="d6b9734d-f5b0-4f6d-91f0-dc38bb5868d9" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="32.1" HigherBound="33.1">
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Schemas.SforceServiceClient.upsertResponse" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgUpsertResponse" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="84c7f6e4-ee01-405e-9d95-dbf655eefae7" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="33.1" HigherBound="34.1">
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgXmlDoc" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="984c3f82-c33c-471f-acad-18a3bc9bce77" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="34.1" HigherBound="35.1">
                <om:Property Name="Type" Value="System.Xml.XmlDocument" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgFailedInterchange" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="MessageDeclaration" OID="ac3deb3b-17d7-45de-9731-5cb4e21042c0" ParentLink="ServiceDeclaration_MessageDeclaration" LowerBound="35.1" HigherBound="36.1">
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.emailExceptionType" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="msgEmailException" />
                <om:Property Name="Signal" Value="True" />
            </om:Element>
            <om:Element Type="ServiceBody" OID="61dd9dd8-22a1-495f-87e0-a58248e4584e" ParentLink="ServiceDeclaration_ServiceBody">
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="Receive" OID="ad94e6df-1b6c-421b-aa61-cf2a528520f7" ParentLink="ServiceBody_Statement" LowerBound="52.1" HigherBound="64.1">
                    <om:Property Name="Activate" Value="True" />
                    <om:Property Name="PortName" Value="Port_InAccountXmlMsg" />
                    <om:Property Name="MessageName" Value="msgInXml" />
                    <om:Property Name="OperationName" Value="Operation_InAccountXmlMsg" />
                    <om:Property Name="OperationMessageName" Value="Request" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="rcv_AccXmlMsg" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="DNFPredicate" OID="6828b87e-bcff-4e4a-a5bd-a6bfaa073a14" ParentLink="Receive_DNFPredicate">
                        <om:Property Name="LHS" Value="BTS.MessageType" />
                        <om:Property Name="RHS" Value="&quot;http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive#Receive&quot;" />
                        <om:Property Name="Grouping" Value="OR" />
                        <om:Property Name="Operator" Value="Equals" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="DNFPredicate" OID="cf06e451-b8d2-4e2d-90c9-c273ee450359" ParentLink="Receive_DNFPredicate">
                        <om:Property Name="LHS" Value="BTS.Operation" />
                        <om:Property Name="RHS" Value="&quot;Operation_SendResubmitMsg&quot;" />
                        <om:Property Name="Grouping" Value="AND" />
                        <om:Property Name="Operator" Value="Equals" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="DNFPredicate" OID="4aa7a8c6-d43b-4bc2-815a-7945b50ad553" ParentLink="Receive_DNFPredicate">
                        <om:Property Name="LHS" Value="BTS.MessageType" />
                        <om:Property Name="RHS" Value="&quot;http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive#Receive&quot;" />
                        <om:Property Name="Grouping" Value="AND" />
                        <om:Property Name="Operator" Value="Equals" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                </om:Element>
                <om:Element Type="VariableAssignment" OID="8b4c3830-8680-4029-a120-4774ae3f4f31" ParentLink="ServiceBody_Statement" LowerBound="64.1" HigherBound="69.1">
                    <om:Property Name="Expression" Value="varXmlDoc = msgInXml;&#xD;&#xA;&#xD;&#xA;token = System.Guid.NewGuid();//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceIn(&quot;SAPToSMAXAccount Orchestration started&quot;);&#xD;&#xA;////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Received Message from SAP&quot;, token));&#xD;&#xA;" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="exp_InitialiseTracing" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="VariableAssignment" OID="e8b62bb0-c91f-433f-9ac5-0ed10ad4a95d" ParentLink="ServiceBody_Statement" LowerBound="69.1" HigherBound="78.1">
                    <om:Property Name="Expression" Value="////flowTracker = new Visy.SAP.ServiceMax.Helpers.OrchestrationESApiAccount.SAPToServiceMaxAccount();&#xD;&#xA;////flowTracker.BeginSAPToServiceMaxAccountActivity();&#xD;&#xA;////flowTracker.MsgReceivedTime = System.DateTime.Now.ToString();&#xD;&#xA;////flowTracker.MessageData = varXmlDoc.OuterXml;&#xD;&#xA;////flowTracker.CommitSAPToServiceMaxAccountActivity();&#xD;&#xA;&#xD;&#xA;////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : BAM Tracking has Started , Activity ID :&quot; + //flowTracker.ActivityID ,token));&#xD;&#xA;varDocNum = &quot;&quot;;" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="exp_BAMTracking" />
                    <om:Property Name="Signal" Value="True" />
                </om:Element>
                <om:Element Type="Scope" OID="f03efdfb-9fa9-4eea-bf07-b99ae8ca47c4" ParentLink="ServiceBody_Statement" LowerBound="78.1" HigherBound="401.1">
                    <om:Property Name="InitializedTransactionType" Value="True" />
                    <om:Property Name="IsSynchronized" Value="False" />
                    <om:Property Name="ReportToAnalyst" Value="True" />
                    <om:Property Name="Name" Value="scope_Main" />
                    <om:Property Name="Signal" Value="True" />
                    <om:Element Type="VariableAssignment" OID="eb676080-037e-42ee-96ce-6b8fc666648b" ParentLink="ComplexStatement_Statement" LowerBound="83.1" HigherBound="90.1">
                        <om:Property Name="Expression" Value="varRetryLimit = System.Convert.ToInt32(Visy.Middleware.Components.Utilities.DataLookupHelper.GetInterfaceLookupData(&quot;RetryLimit&quot;, &quot;SAP.ServiceMax&quot;));&#xD;&#xA;varRetryInterval = System.Convert.ToInt32(Visy.Middleware.Components.Utilities.DataLookupHelper.GetInterfaceLookupData(&quot;RetryInterval&quot;, &quot;SAP.ServiceMax&quot;));&#xD;&#xA;varRetryCount = 1;&#xD;&#xA;&#xD;&#xA;////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Login Orchestration Started &quot; ,token));&#xD;&#xA;&#xD;&#xA;" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="Exp_SetRetryCount" />
                        <om:Property Name="Signal" Value="False" />
                    </om:Element>
                    <om:Element Type="Scope" OID="40072314-aa0b-4d56-a245-0e8566a5a36b" ParentLink="ComplexStatement_Statement" LowerBound="90.1" HigherBound="335.1">
                        <om:Property Name="InitializedTransactionType" Value="True" />
                        <om:Property Name="IsSynchronized" Value="False" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="scope_LoginAndUpsert" />
                        <om:Property Name="Signal" Value="False" />
                        <om:Element Type="Call" OID="92c8318b-7ef3-4919-a221-3ccb767cf26e" ParentLink="ComplexStatement_Statement" LowerBound="95.1" HigherBound="97.1">
                            <om:Property Name="Identifier" Value="CallSMLoginOrch" />
                            <om:Property Name="Invokee" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.ServiceMaxLogin" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="callorch_ServiceMaxLogin" />
                            <om:Property Name="Signal" Value="False" />
                            <om:Element Type="Parameter" OID="a51fae3c-c600-461a-9d21-811f82a23678" ParentLink="InvokeStatement_Parameter">
                                <om:Property Name="Direction" Value="In" />
                                <om:Property Name="Name" Value="token" />
                                <om:Property Name="Type" Value="System.Guid" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="VariableAssignment" OID="b4176921-f6aa-4794-b467-26ca953b4277" ParentLink="ComplexStatement_Statement" LowerBound="97.1" HigherBound="109.1">
                            <om:Property Name="Expression" Value="//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Call Orchestration completed; Control back to Parent Orch&quot;,token));&#xD;&#xA;&#xD;&#xA;varDocNum = xpath(msgInXml, &quot;string(/*[local-name()='Receive' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='idocData' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='EDI_DC40' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='DOCNUM' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/Common/'])&quot;);&#xD;&#xA;//flowTracker.ServerUrl = Visy.SAP.ServiceMax.Helpers.SessionDetails.ServerUrl;&#xD;&#xA;//flowTracker.SessionID = Visy.SAP.ServiceMax.Helpers.SessionDetails.SessionId;&#xD;&#xA;//flowTracker.ExternalId=xpath(msgInXml,&quot;string(/*[local-name()='Receive' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='idocData' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='E2KNA1M005GRP' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='E2KNA1M005' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='KUNNR' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740'])&quot;);&#xD;&#xA;//flowTracker.IDOCDocNum= varDocNum;&#xD;&#xA;//flowTracker.IntegrationPoint=&quot;SAP-SMAX_ACC&quot;;&#xD;&#xA;//flowTracker.CommitSAPToServiceMaxAccountActivity();&#xD;&#xA;varUpsertResp = &quot;false&quot;;&#xD;&#xA;&#xD;&#xA;" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="exp_BAMTracking" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                        <om:Element Type="Construct" OID="56c7d563-ddb1-4e9d-aa79-ed8a3976a39d" ParentLink="ComplexStatement_Statement" LowerBound="109.1" HigherBound="117.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="construct_ACCDEBMAS07" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="2708a982-ebae-436b-a19b-92d728ed8096" ParentLink="Construct_MessageRef" LowerBound="110.39" HigherBound="110.50">
                                <om:Property Name="Ref" Value="msgDEBMAS07" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="2fccb681-719c-4018-82a5-1da03df24ff7" ParentLink="ComplexStatement_Statement" LowerBound="112.1" HigherBound="116.1">
                                <om:Property Name="Expression" Value="msgDEBMAS07 = varXmlDoc;&#xD;&#xA;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : DEBMAS07 message has been constructed&quot;,token));&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="MsgAssign_VendorMgs" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Construct" OID="7a666c94-1a46-431d-9d16-a3847adfa57e" ParentLink="ComplexStatement_Statement" LowerBound="117.1" HigherBound="136.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="construct_UpsertReq" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="350a1940-5233-4723-bb34-89ae55ee506d" ParentLink="Construct_MessageRef" LowerBound="118.39" HigherBound="118.55">
                                <om:Property Name="Ref" Value="msgUpsertRequest" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="Transform" OID="70439f53-34bf-4341-bb80-7c5fa2c6404f" ParentLink="ComplexStatement_Statement" LowerBound="120.1" HigherBound="122.1">
                                <om:Property Name="ClassName" Value="Visy.Middleware.SAP.ServiceMax.Maps.DEBMAS07_To_Upsert" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="map_To_Upsert" />
                                <om:Property Name="Signal" Value="False" />
                                <om:Element Type="MessagePartRef" OID="8a18bfb3-6c53-41d1-b04f-95972ddc9c86" ParentLink="Transform_InputMessagePartRef" LowerBound="121.131" HigherBound="121.142">
                                    <om:Property Name="MessageRef" Value="msgDEBMAS07" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="MessagePartReference_1" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                                <om:Element Type="MessagePartRef" OID="a070a3a5-07c8-4f8d-98b6-b12868605fad" ParentLink="Transform_OutputMessagePartRef" LowerBound="121.44" HigherBound="121.71">
                                    <om:Property Name="MessageRef" Value="msgUpsertRequest" />
                                    <om:Property Name="PartRef" Value="parameters" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="MessagePartReference_2" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="eb4b2f8e-2c21-4db6-b864-086b120eb7f6" ParentLink="ComplexStatement_Statement" LowerBound="122.1" HigherBound="135.1">
                                <om:Property Name="Expression" Value="msgUpsertRequest(WCF.SecurityMode)=&quot;Transport&quot;;&#xD;&#xA;msgUpsertRequest(WCF.TransportClientCredentialType) = &quot;None&quot;;&#xD;&#xA;msgUpsertRequest(WCF.Action)=&quot;&quot;;&#xD;&#xA;msgUpsertRequest(WCF.OutboundCustomHeaders) = &quot;&lt;headers&gt;&lt;SessionHeader xmlns='urn:enterprise.soap.sforce.com'&gt;&lt;sessionId&gt;&quot; + Visy.Middleware.SAP.ServiceMax.Components.SessionDetails.SessionId + &quot;&lt;/sessionId&gt;&lt;/SessionHeader&gt;&lt;/headers&gt;&quot;;&#xD;&#xA;&#xD;&#xA;Port_SendAccountUpsert(Microsoft.XLANGs.BaseTypes.Address) = Visy.Middleware.SAP.ServiceMax.Components.SessionDetails.ServerUrl;&#xD;&#xA;Port_SendAccountUpsert(Microsoft.XLANGs.BaseTypes.TransportType)=&quot;WCF-BasicHttp&quot;;&#xD;&#xA;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Upsert Request message has been constructed&quot;,token));&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Session ID &quot; + Visy.SAP.ServiceMax.Helpers.SessionDetails.SessionId,token));&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : URL&quot; + Visy.SAP.ServiceMax.Helpers.SessionDetails.ServerUrl,token));&#xD;&#xA;varXmlDocForBAM = msgUpsertRequest.parameters;&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="Msgassign_UpsertReq" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Construct" OID="b4bcc4fe-d64f-4b1f-b3c1-54852ba43cba" ParentLink="ComplexStatement_Statement" LowerBound="136.1" HigherBound="149.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="construct_UpsertRes" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageRef" OID="bfca1148-f650-4df5-ab9f-cb6d0acb453f" ParentLink="Construct_MessageRef" LowerBound="137.39" HigherBound="137.56">
                                <om:Property Name="Ref" Value="msgUpsertResponse" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="MessageAssignment" OID="2682ec9b-ebcd-447e-98b9-f160d6cf07e0" ParentLink="ComplexStatement_Statement" LowerBound="139.1" HigherBound="148.1">
                                <om:Property Name="Expression" Value="varXmlDoc = new System.Xml.XmlDocument();&#xD;&#xA;varXmlDoc.LoadXml(@&quot;&lt;upsertResponse xmlns='urn:enterprise.soap.sforce.com'&gt;&lt;result&gt;&lt;created&gt;&lt;/created&gt;&lt;id&gt;&lt;/id&gt;&lt;success&gt;&lt;/success&gt;&lt;/result&gt;&lt;/upsertResponse&gt;&quot;);&#xD;&#xA;msgUpsertResponse.parameters=varXmlDoc;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Upsert Response message has been constructed&quot;,token));&#xD;&#xA;&#xD;&#xA;varExpObj = new System.Exception();&#xD;&#xA;varIsException = false;&#xD;&#xA;varIsSoapExp = false;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="msgassign_UpsertReq" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="While" OID="355cd7b9-eb8d-433f-8c0a-a28536fb539d" ParentLink="ComplexStatement_Statement" LowerBound="149.1" HigherBound="254.1">
                            <om:Property Name="Expression" Value="varRetryCount &lt;= varRetryLimit" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="loop_Retry" />
                            <om:Property Name="Signal" Value="False" />
                            <om:Element Type="Scope" OID="aedcfbce-fe97-4bbc-9b69-7cb9d4680a8a" ParentLink="ComplexStatement_Statement" LowerBound="152.1" HigherBound="191.1">
                                <om:Property Name="InitializedTransactionType" Value="True" />
                                <om:Property Name="IsSynchronized" Value="False" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="scope_Upsert" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="Send" OID="59c288fb-cc1c-4ff2-9e03-22a7ee4be1c5" ParentLink="ComplexStatement_Statement" LowerBound="157.1" HigherBound="159.1">
                                    <om:Property Name="PortName" Value="Port_SendAccountUpsert" />
                                    <om:Property Name="MessageName" Value="msgUpsertRequest" />
                                    <om:Property Name="OperationName" Value="Operation_SendUpsert" />
                                    <om:Property Name="OperationMessageName" Value="Request" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="send_UpsertReq" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="Receive" OID="77d203b8-8f09-4992-a927-cc1356ec8137" ParentLink="ComplexStatement_Statement" LowerBound="159.1" HigherBound="161.1">
                                    <om:Property Name="Activate" Value="False" />
                                    <om:Property Name="PortName" Value="Port_SendAccountUpsert" />
                                    <om:Property Name="MessageName" Value="msgUpsertResponse" />
                                    <om:Property Name="OperationName" Value="Operation_SendUpsert" />
                                    <om:Property Name="OperationMessageName" Value="Response" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="rcv_UpsertRes" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="Catch" OID="c237b9fd-651a-44bb-be32-1662d9bfdf61" ParentLink="Scope_Catch" LowerBound="164.1" HigherBound="176.1">
                                    <om:Property Name="ExceptionName" Value="excp" />
                                    <om:Property Name="ExceptionType" Value="System.Exception" />
                                    <om:Property Name="IsFaultMessage" Value="False" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="catch_SystemExcp" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="080947a4-0126-4ec5-88c5-0cebaf2454d0" ParentLink="Catch_Statement" LowerBound="167.1" HigherBound="175.1">
                                        <om:Property Name="Expression" Value="varExpObj = new System.Exception();&#xD;&#xA;varExpObj = excp;&#xD;&#xA;varIsException = true;&#xD;&#xA;varIsSoapExp = false;&#xD;&#xA;System.Diagnostics.EventLog.WriteEntry(&quot;BizTalkApp&quot;, &quot;SAP.ServiceMax: &quot; + System.String.Format(&quot;{0} :Error in Transmitting the message.{1}; Retry count:&quot;+varRetryCount.ToString(), token, excp.ToString()));&#xD;&#xA;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} :Error in Transmitting the message.{1}; Retry count:&quot;+varRetryCount.ToString(), token, excp.ToString()));&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_TraceException" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="Catch" OID="1be4b2a0-9c99-4d61-a6a5-e35253aa091e" ParentLink="Scope_Catch" LowerBound="176.1" HigherBound="189.1">
                                    <om:Property Name="ExceptionName" Value="soapExc" />
                                    <om:Property Name="ExceptionType" Value="Port_SendAccountUpsert.Operation_SendUpsert.GenericSoapFault" />
                                    <om:Property Name="IsFaultMessage" Value="False" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="catch_SOAPExcp" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="83d00172-c218-4617-9016-bff9a8a5240a" ParentLink="Catch_Statement" LowerBound="179.1" HigherBound="188.1">
                                        <om:Property Name="Expression" Value="varException = xpath(soapExc, &quot;string(/*[local-name()='Fault' and namespace-uri()='http://schemas.xmlsoap.org/soap/envelope/']/*[local-name()='faultstring' and namespace-uri()=''])&quot;);&#xD;&#xA;varExpObj = new System.Exception(&quot;ServiceMax returned an error message&quot; + varException);&#xD;&#xA;varIsException = true;&#xD;&#xA;varIsSoapExp = true;&#xD;&#xA;&#xD;&#xA;System.Diagnostics.EventLog.WriteEntry(&quot;BizTalkApp&quot;, &quot;SAP.ServiceMax: &quot; + System.String.Format(&quot;{0} :A SOAP exception has occured within the First Upsert call. Error Description: &quot;+ varException, token));&#xD;&#xA;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} :A SOAP exception has occured within the First Upsert call. Error Description: &quot;+ varException, token));&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_SoapExcp" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                            <om:Element Type="VariableAssignment" OID="23566eab-9679-4933-83f0-600dd8b51571" ParentLink="ComplexStatement_Statement" LowerBound="191.1" HigherBound="197.1">
                                <om:Property Name="Expression" Value="varXmlDoc = new System.Xml.XmlDocument();&#xD;&#xA;varXmlDoc = msgUpsertResponse.parameters;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Upsert Response - {1}&quot;, token, varXmlDoc.InnerXml));&#xD;&#xA;varUpsertResp = xpath(msgUpsertResponse.parameters, &quot;string(/*[local-name()='upsertResponse' and namespace-uri()='urn:enterprise.soap.sforce.com']/*[local-name()='result' and namespace-uri()='urn:enterprise.soap.sforce.com']/*[local-name()='success' and namespace-uri()='urn:enterprise.soap.sforce.com'])&quot;);&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Upsert Result :&quot; + varUpsertResp, token));" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="exp_ReadResult" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="Decision" OID="a16b717a-0a81-4e1c-8b19-f441dbcb54ad" ParentLink="ComplexStatement_Statement" LowerBound="197.1" HigherBound="253.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="decide_RetryCount" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="DecisionBranch" OID="a81efdcd-4b36-406b-b539-850f64102a56" ParentLink="ReallyComplexStatement_Branch" LowerBound="198.33" HigherBound="206.1">
                                    <om:Property Name="Expression" Value="(varRetryCount &gt;= varRetryLimit &amp;&amp; varIsException == true)" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="rule_RetryCountLimit" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="5630ba82-ccfd-4515-824e-8c739f6bc2de" ParentLink="ComplexStatement_Statement" LowerBound="200.1" HigherBound="203.1">
                                        <om:Property Name="Expression" Value="varRetryCount = varRetryLimit + 1;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : An error occurred during the Upsert call. Exiting the loop&quot;,token));" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_ExitRetry" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                    <om:Element Type="Throw" OID="320dff89-f5e3-4c9a-a5c1-83bd8fb0e83b" ParentLink="ComplexStatement_Statement" LowerBound="203.1" HigherBound="205.1">
                                        <om:Property Name="ThrownReference" Value="varExpObj" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="throwException" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="d06e1cc0-b51f-41be-8ea4-f281649951f5" ParentLink="ReallyComplexStatement_Branch" LowerBound="206.38" HigherBound="221.1">
                                    <om:Property Name="Expression" Value="(varIsException == false) &amp;&amp; (varUpsertResp == &quot;true&quot;)" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="rule_NoException" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="a59d0129-740b-4f7a-bb89-dd8420536071" ParentLink="ComplexStatement_Statement" LowerBound="208.1" HigherBound="220.1">
                                        <om:Property Name="Expression" Value="//flowTracker.IsError = &quot;False&quot;;&#xD;&#xA;//flowTracker.IsRetrying = &quot;False&quot;;&#xD;&#xA;//flowTracker.IsSentToServiceMax = &quot;Success&quot;;&#xD;&#xA;//flowTracker.IsEmailSent = &quot;False&quot;;&#xD;&#xA;//flowTracker.IsMessageSuspended = &quot;False&quot;;&#xD;&#xA;//flowTracker.FirstReqSentToServiceMaxTime = System.DateTime.Now.ToString();&#xD;&#xA;//flowTracker.FirstServiceMaxRespMsg = varXmlDoc.OuterXml;&#xD;&#xA;//flowTracker.CommitSAPToServiceMaxAccountActivity();&#xD;&#xA;varRetryCount = varRetryLimit + 1;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : First Upsert successfully completed; Upsert response: &quot; + varXmlDoc.OuterXml.ToString(), token));&#xD;&#xA;&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_BAMTracking" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="7c10f207-c8e6-40fe-ab5d-3f8c04b1cd6e" ParentLink="ReallyComplexStatement_Branch" LowerBound="221.38" HigherBound="236.1">
                                    <om:Property Name="Expression" Value="varUpsertResp == &quot;false&quot;" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="rule_UpsertResp" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="Construct" OID="e6b87dcd-c8ee-4479-9117-8b8130e89521" ParentLink="ComplexStatement_Statement" LowerBound="223.1" HigherBound="229.1">
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="construct_XMLDocUpsertRespMsg" />
                                        <om:Property Name="Signal" Value="True" />
                                        <om:Element Type="MessageRef" OID="988259b9-340b-4b68-9873-6142c24ef366" ParentLink="Construct_MessageRef" LowerBound="224.47" HigherBound="224.56">
                                            <om:Property Name="Ref" Value="msgXmlDoc" />
                                            <om:Property Name="ReportToAnalyst" Value="True" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                        <om:Element Type="MessageAssignment" OID="0307af40-127b-4e74-850e-1a1ffcef4135" ParentLink="ComplexStatement_Statement" LowerBound="226.1" HigherBound="228.1">
                                            <om:Property Name="Expression" Value="msgXmlDoc = msgUpsertResponse.parameters;&#xD;&#xA;" />
                                            <om:Property Name="ReportToAnalyst" Value="False" />
                                            <om:Property Name="Name" Value="msgAssign_UpsertResp" />
                                            <om:Property Name="Signal" Value="False" />
                                        </om:Element>
                                    </om:Element>
                                    <om:Element Type="VariableAssignment" OID="3d0ca338-9450-4c09-a759-082a77d39040" ParentLink="ComplexStatement_Statement" LowerBound="229.1" HigherBound="233.1">
                                        <om:Property Name="Expression" Value="varRetryCount = varRetryLimit + 1;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Upsert returned a failure response. &quot;+msgXmlDoc.OuterXml,token));&#xD;&#xA;varExpObj = new System.Exception(System.String.Format(&quot;ServiceMax returned an error message; &lt;xmp&gt;{0}&lt;/xmp&gt;​&quot;, msgXmlDoc.OuterXml));" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_ExitRetry" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Throw" OID="c39bc444-d9c9-4ec2-819b-9e3b868a8fe0" ParentLink="ComplexStatement_Statement" LowerBound="233.1" HigherBound="235.1">
                                        <om:Property Name="ThrownReference" Value="varExpObj" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="throwException" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="596ecede-815e-4eaa-bb6e-8c15c80f8142" ParentLink="ReallyComplexStatement_Branch" LowerBound="236.38" HigherBound="244.1">
                                    <om:Property Name="Expression" Value="varIsSoapExp == true" />
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="rule_SOAPExp" />
                                    <om:Property Name="Signal" Value="True" />
                                    <om:Element Type="VariableAssignment" OID="fb1c1830-06f1-4856-bdfc-e7d4720902f3" ParentLink="ComplexStatement_Statement" LowerBound="238.1" HigherBound="241.1">
                                        <om:Property Name="Expression" Value="varRetryCount = varRetryLimit + 1;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : A SOAP exception occurred during the Upsert call. Exiting the loop&quot;,token));" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_ExitRetry" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Throw" OID="1f322880-91ab-4d66-a0c3-60d950cae09e" ParentLink="ComplexStatement_Statement" LowerBound="241.1" HigherBound="243.1">
                                        <om:Property Name="ThrownReference" Value="varExpObj" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="throwException" />
                                        <om:Property Name="Signal" Value="True" />
                                    </om:Element>
                                </om:Element>
                                <om:Element Type="DecisionBranch" OID="255eba12-4488-47d1-a202-0092b73f1fa5" ParentLink="ReallyComplexStatement_Branch">
                                    <om:Property Name="IsGhostBranch" Value="True" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Name" Value="Else" />
                                    <om:Property Name="Signal" Value="False" />
                                    <om:Element Type="VariableAssignment" OID="8d4d4d1e-3af8-4fb8-aeec-132516c5de8e" ParentLink="ComplexStatement_Statement" LowerBound="246.1" HigherBound="250.1">
                                        <om:Property Name="Expression" Value="varRetryCount = varRetryCount +1;&#xD;&#xA;varIsException =false;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Error in transmitting the upsert request; Waiting to retry&quot;,token));&#xD;&#xA;" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="exp_IncrementRetryCount" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                    <om:Element Type="Delay" OID="76c4eaf5-d5c4-495a-88d0-e0d4beddc455" ParentLink="ComplexStatement_Statement" LowerBound="250.1" HigherBound="252.1">
                                        <om:Property Name="Timeout" Value="new System.TimeSpan(0,varRetryInterval,0);" />
                                        <om:Property Name="ReportToAnalyst" Value="True" />
                                        <om:Property Name="Name" Value="delay_RetryInterval" />
                                        <om:Property Name="Signal" Value="False" />
                                    </om:Element>
                                </om:Element>
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Catch" OID="321a392a-b823-4221-b77f-f2c37ae73534" ParentLink="Scope_Catch" LowerBound="257.1" HigherBound="333.1">
                            <om:Property Name="ExceptionName" Value="AllExcp" />
                            <om:Property Name="ExceptionType" Value="System.Exception" />
                            <om:Property Name="IsFaultMessage" Value="False" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="catch_SystemExcp" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="VariableAssignment" OID="ca6364fb-f578-4ce6-9385-3ba07c9c224e" ParentLink="Catch_Statement" LowerBound="260.1" HigherBound="262.1">
                                <om:Property Name="Expression" Value="varErrorMsg = AllExcp.ToString();" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="ErrorMessage" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                            <om:Element Type="Construct" OID="d28fb8f5-be52-429e-81f3-1427362067b3" ParentLink="Catch_Statement" LowerBound="262.1" HigherBound="270.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="construct_FailedInterchangeMsg" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="MessageAssignment" OID="8d03e80d-1bb8-4868-963b-441d0a21625b" ParentLink="ComplexStatement_Statement" LowerBound="265.1" HigherBound="269.1">
                                    <om:Property Name="Expression" Value="msgFailedInterchange = msgInXml;&#xD;&#xA;msgFailedInterchange(Visy.Middleware.SAP.ServiceMax.Schemas.ErrorDescription) = varErrorMsg;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Sending Mesasage to Suspend Orchestration&quot;,token));&#xD;&#xA;" />
                                    <om:Property Name="ReportToAnalyst" Value="False" />
                                    <om:Property Name="Name" Value="msgassign_OriginialMsg" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="MessageRef" OID="6a3185da-3e4a-4198-818f-f0986fbbd832" ParentLink="Construct_MessageRef" LowerBound="263.43" HigherBound="263.63">
                                    <om:Property Name="Ref" Value="msgFailedInterchange" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Construct" OID="d81b9f9f-e18f-42ca-9c92-9c092fc6ee20" ParentLink="Catch_Statement" LowerBound="270.1" HigherBound="326.1">
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="ConstructExceptionEmail" />
                                <om:Property Name="Signal" Value="True" />
                                <om:Element Type="MessageAssignment" OID="dc4531e2-61df-4702-9879-ac5113f6dde4" ParentLink="ComplexStatement_Statement" LowerBound="273.1" HigherBound="325.1">
                                    <om:Property Name="Expression" Value="//Build HTML Message body&#xD;&#xA;varBuilder_MsgBody = new System.Text.StringBuilder();&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;html&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;head&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/head&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;body&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;p&gt;&lt;B&gt;SAPToSMAXAccount Orchestration Error&lt;/B&gt;&lt;/p&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;table&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Date of Error:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortDateString());&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Time of Error:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortTimeString());&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Integration Point:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;SAP-SMAX_ACC&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Exception:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(varErrorMsg);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;IDOC DocNum of Incoming Message:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(varDocNum);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Processing Server:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.Environment.MachineName);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/table&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/body&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/html&gt;&quot;);&#xD;&#xA;&#xD;&#xA;//Set Email Properties&#xD;&#xA;msgEmailException.msgBody = new Visy.Middleware.SAP.ServiceMax.Components.RawString(varBuilder_MsgBody.ToString());&#xD;&#xA;msgEmailException.msgBody(Microsoft.XLANGs.BaseTypes.ContentType) = &quot;text/html&quot;;&#xD;&#xA;msgEmailException(SMTP.Subject) = &quot;SAPToSMAXAccount Orchestration failed in BizTalk Server: &quot; + System.Environment.MachineName;&#xD;&#xA;&#xD;&#xA;msgEmailException(SMTP.From) = &quot;webitadmin@visy.com.au&quot;;&#xD;&#xA;msgEmailException(SMTP.EmailBodyFileCharset) = &quot;UTF-8&quot;;&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Created SMTP Mail Message&quot;,token));&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;" />
                                    <om:Property Name="ReportToAnalyst" Value="False" />
                                    <om:Property Name="Name" Value="msgassign_ExceptionMail" />
                                    <om:Property Name="Signal" Value="True" />
                                </om:Element>
                                <om:Element Type="MessageRef" OID="2fa98c02-8fc0-405b-a6bb-7ccdb50ffff5" ParentLink="Construct_MessageRef" LowerBound="271.43" HigherBound="271.60">
                                    <om:Property Name="Ref" Value="msgEmailException" />
                                    <om:Property Name="ReportToAnalyst" Value="True" />
                                    <om:Property Name="Signal" Value="False" />
                                </om:Element>
                            </om:Element>
                            <om:Element Type="Send" OID="c305bb9a-e6ee-4cc4-97f5-d3dfc6e01ab2" ParentLink="Catch_Statement" LowerBound="326.1" HigherBound="328.1">
                                <om:Property Name="PortName" Value="Port_SendMailForAccount" />
                                <om:Property Name="MessageName" Value="msgEmailException" />
                                <om:Property Name="OperationName" Value="Operation_SendMailForAccount" />
                                <om:Property Name="OperationMessageName" Value="Request" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="send_Mail" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="Send" OID="ce3dc925-36d9-40d3-b559-a7558e7cf250" ParentLink="Catch_Statement" LowerBound="328.1" HigherBound="330.1">
                                <om:Property Name="PortName" Value="Port_SendSusMsgForAccount" />
                                <om:Property Name="MessageName" Value="msgFailedInterchange" />
                                <om:Property Name="OperationName" Value="Operation_SendSusMsg" />
                                <om:Property Name="OperationMessageName" Value="Request" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="send_SuspendMsg" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="Terminate" OID="0b98a603-5238-430a-b40f-5575f4330865" ParentLink="Catch_Statement" LowerBound="330.1" HigherBound="332.1">
                                <om:Property Name="ErrorMessage" Value="&quot;Service Max Part Update terminated due to error:&quot; + AllExcp.Message;" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Name" Value="Terminate" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                        </om:Element>
                    </om:Element>
                    <om:Element Type="Catch" OID="568d2f01-c49a-438e-9ea8-4f6085b37703" ParentLink="Scope_Catch" LowerBound="338.1" HigherBound="399.1">
                        <om:Property Name="ExceptionName" Value="sysex" />
                        <om:Property Name="ExceptionType" Value="System.Exception" />
                        <om:Property Name="IsFaultMessage" Value="False" />
                        <om:Property Name="ReportToAnalyst" Value="True" />
                        <om:Property Name="Name" Value="catch_GeneralExcp" />
                        <om:Property Name="Signal" Value="True" />
                        <om:Element Type="VariableAssignment" OID="c3bef3ef-32ed-4ced-8137-ed809330bd5e" ParentLink="Catch_Statement" LowerBound="341.1" HigherBound="344.1">
                            <om:Property Name="Expression" Value="varErrorMsg =&quot;A General exception occurred in ServiceMax SAPToSMAXAccount Orchestration.&quot; + sysex.ToString();&#xD;&#xA;//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format(&quot;{0} : Error in Service Max.Exception :&quot;,token)+ varErrorMsg);&#xD;&#xA;" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="exp_Tracing" />
                            <om:Property Name="Signal" Value="False" />
                        </om:Element>
                        <om:Element Type="Construct" OID="123b8787-7b24-4733-b85d-eca6855deaca" ParentLink="Catch_Statement" LowerBound="344.1" HigherBound="396.1">
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="ConstructExceptionEmail" />
                            <om:Property Name="Signal" Value="True" />
                            <om:Element Type="MessageAssignment" OID="f5a60ede-60b3-47a7-a2b2-dda7ff104443" ParentLink="ComplexStatement_Statement" LowerBound="347.1" HigherBound="395.1">
                                <om:Property Name="Expression" Value="&#xD;&#xA;varBuilder_MsgBody = new System.Text.StringBuilder();&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;html&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;head&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/head&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;body&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;p&gt;&lt;B&gt;SAPToSMAXAccount Orchestration Error&lt;/B&gt;&lt;/p&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;table&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Date of Error:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortDateString());&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Time of Error:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortTimeString());&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Integration Point:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;SAP-SMAX_ACC&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Exception:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(varErrorMsg);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;IDOC DocNum of Incoming Message:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(varDocNum);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;tr&gt;&lt;td&gt;Processing Server:&lt;/td&gt;&lt;td&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(System.Environment.MachineName);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/td&gt;&lt;/tr&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/table&gt;&quot;);&#xD;&#xA;&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/body&gt;&quot;);&#xD;&#xA;varBuilder_MsgBody.AppendLine(&quot;&lt;/html&gt;&quot;);&#xD;&#xA;&#xD;&#xA;//Set Email Properties&#xD;&#xA;msgEmailException.msgBody = new Visy.Middleware.SAP.ServiceMax.Components.RawString(varBuilder_MsgBody.ToString());&#xD;&#xA;msgEmailException.msgBody(Microsoft.XLANGs.BaseTypes.ContentType) = &quot;text/html&quot;;&#xD;&#xA;msgEmailException(SMTP.Subject) = &quot;SAPToSMAXAccount Orchestration failed in BizTalk Server: &quot; + System.Environment.MachineName;&#xD;&#xA;&#xD;&#xA;msgEmailException(SMTP.From) = &quot;bt2016@visy.com.au&quot;;&#xD;&#xA;msgEmailException(SMTP.EmailBodyFileCharset) = &quot;UTF-8&quot;;&#xD;&#xA;&#xD;&#xA;" />
                                <om:Property Name="ReportToAnalyst" Value="False" />
                                <om:Property Name="Name" Value="msgassign_ExceptionMail" />
                                <om:Property Name="Signal" Value="True" />
                            </om:Element>
                            <om:Element Type="MessageRef" OID="7ddd6447-f5e5-4d84-a0ab-91d664b7e2af" ParentLink="Construct_MessageRef" LowerBound="345.35" HigherBound="345.52">
                                <om:Property Name="Ref" Value="msgEmailException" />
                                <om:Property Name="ReportToAnalyst" Value="True" />
                                <om:Property Name="Signal" Value="False" />
                            </om:Element>
                        </om:Element>
                        <om:Element Type="Send" OID="c29295d2-7c26-4ce3-a7a6-9df5dd4cd313" ParentLink="Catch_Statement" LowerBound="396.1" HigherBound="398.1">
                            <om:Property Name="PortName" Value="Port_SendMailForAccount" />
                            <om:Property Name="MessageName" Value="msgEmailException" />
                            <om:Property Name="OperationName" Value="Operation_SendMailForAccount" />
                            <om:Property Name="OperationMessageName" Value="Request" />
                            <om:Property Name="ReportToAnalyst" Value="True" />
                            <om:Property Name="Name" Value="send_Mail" />
                            <om:Property Name="Signal" Value="True" />
                        </om:Element>
                    </om:Element>
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="b440129a-6b0f-40f9-a002-8ff727bd3d07" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="21.1" HigherBound="23.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="7" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.PortType_SendUpsertReq" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Port_SendAccountUpsert" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="PhysicalBindingAttribute" OID="084928be-c557-42f6-b600-acce2fb184b3" ParentLink="PortDeclaration_CLRAttribute" LowerBound="21.1" HigherBound="22.1">
                    <om:Property Name="InPipeline" Value="Microsoft.BizTalk.DefaultPipelines.XMLReceive" />
                    <om:Property Name="OutPipeline" Value="Microsoft.BizTalk.DefaultPipelines.XMLTransmit" />
                    <om:Property Name="TransportType" Value="HTTP" />
                    <om:Property Name="URI" Value="http://tempURI" />
                    <om:Property Name="IsDynamic" Value="True" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="02ff7910-9f34-4056-bdee-59a65f6798f9" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="23.1" HigherBound="25.1">
                <om:Property Name="PortModifier" Value="Implements" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="1" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.PortType_InAccountXmlMsg" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Port_InAccountXmlMsg" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="DirectBindingAttribute" OID="a83487f3-5d7e-4d09-b5c2-724ecfb34147" ParentLink="PortDeclaration_CLRAttribute" LowerBound="23.1" HigherBound="24.1">
                    <om:Property Name="DirectBindingType" Value="MessageBox" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="adf443d5-9438-4425-bcc7-8a4d30badb20" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="25.1" HigherBound="27.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Left" />
                <om:Property Name="PortIndex" Value="35" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.PortType_SendMailForAccount" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Port_SendMailForAccount" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="LogicalBindingAttribute" OID="72f745ab-2da5-42d9-92ea-5a8260f5bdfc" ParentLink="PortDeclaration_CLRAttribute" LowerBound="25.1" HigherBound="26.1">
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
            <om:Element Type="PortDeclaration" OID="7c10b338-d1dd-4baf-b101-40fc64720feb" ParentLink="ServiceDeclaration_PortDeclaration" LowerBound="27.1" HigherBound="29.1">
                <om:Property Name="PortModifier" Value="Uses" />
                <om:Property Name="Orientation" Value="Unbound" />
                <om:Property Name="PortIndex" Value="-1" />
                <om:Property Name="IsWebPort" Value="False" />
                <om:Property Name="OrderedDelivery" Value="False" />
                <om:Property Name="DeliveryNotification" Value="None" />
                <om:Property Name="Type" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.PortType_SendSusMsg" />
                <om:Property Name="ParamDirection" Value="In" />
                <om:Property Name="ReportToAnalyst" Value="True" />
                <om:Property Name="Name" Value="Port_SendSusMsgForAccount" />
                <om:Property Name="Signal" Value="False" />
                <om:Element Type="DirectBindingAttribute" OID="26f28a3c-103b-4fa0-a7de-ac771d7f8c30" ParentLink="PortDeclaration_CLRAttribute" LowerBound="27.1" HigherBound="28.1">
                    <om:Property Name="PartnerPort" Value="Port_SendSusMsgForAccount" />
                    <om:Property Name="PartnerService" Value="Visy.Middleware.SAP.ServiceMax.Orchestrations.SAPToSMAXAccount" />
                    <om:Property Name="DirectBindingType" Value="PartnerPort" />
                    <om:Property Name="Signal" Value="False" />
                </om:Element>
            </om:Element>
        </om:Element>
    </om:Element>
</om:MetaModel>
#endif // __DESIGNER_DATA
[Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
module Visy.Middleware.SAP.ServiceMax.Orchestrations
{
    internal porttype PortType_InAccountXmlMsg
    {
        oneway Operation_InAccountXmlMsg
        {
            System.Xml.XmlDocument
        };
    };
    internal porttype PortType_SendMailForAccount
    {
        oneway Operation_SendMailForAccount
        {
            emailExceptionType
        };
    };
    [Microsoft.XLANGs.BaseTypes.BPELExportable(false)]
    internal service SAPToSMAXAccount
    {
        [Microsoft.XLANGs.BaseTypes.PhysicalBinding(typeof(Microsoft.BizTalk.DefaultPipelines.XMLReceive), typeof(Microsoft.BizTalk.DefaultPipelines.XMLTransmit))]
        port uses dynamic PortType_SendUpsertReq Port_SendAccountUpsert;
        [Microsoft.XLANGs.BaseTypes.DirectBinding()]
        port implements PortType_InAccountXmlMsg Port_InAccountXmlMsg;
        [Microsoft.XLANGs.BaseTypes.LogicalBinding()]
        port uses PortType_SendMailForAccount Port_SendMailForAccount;
        [Microsoft.XLANGs.BaseTypes.DirectBinding(typeof(Visy.Middleware.SAP.ServiceMax.Orchestrations.SAPToSMAXAccount), "Port_SendSusMsgForAccount")]
        port uses PortType_SendSusMsg Port_SendSusMsgForAccount;
        message System.Xml.XmlDocument msgInXml;
        message Visy.Middleware.Common.Schemas.SAP.ZSM_DEBMAS.IDocOperation_DEBMAS07_ZSM_DEBMAS_740_3_Receive msgDEBMAS07;
        message Visy.Middleware.SAP.ServiceMax.Schemas.SforceServiceClient.upsertRequest msgUpsertRequest;
        message Visy.Middleware.SAP.ServiceMax.Schemas.SforceServiceClient.upsertResponse msgUpsertResponse;
        message System.Xml.XmlDocument msgXmlDoc;
        message System.Xml.XmlDocument msgFailedInterchange;
        message emailExceptionType msgEmailException;
        System.Guid token;
        System.Xml.XmlDocument varXmlDoc;
        System.String varDocNum;
        System.Int32 varRetryLimit;
        System.Int32 varRetryInterval;
        System.Int32 varRetryCount;
        System.String varUpsertResp;
        System.Xml.XmlDocument varXmlDocForBAM;
        System.Exception varExpObj;
        System.Boolean varIsException;
        System.Boolean varIsSoapExp;
        System.String varException;
        System.String varErrorMsg;
        System.Text.StringBuilder varBuilder_MsgBody;
        body ()
        {
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("ad94e6df-1b6c-421b-aa61-cf2a528520f7")]
            activate ((BTS.MessageType == "http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive#Receive") || (BTS.Operation == "Operation_SendResubmitMsg") && (BTS.MessageType == "http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive#Receive"))receive (Port_InAccountXmlMsg.Operation_InAccountXmlMsg, msgInXml);
            varXmlDoc = new System.Xml.XmlDocument();
            varDocNum = "";
            varUpsertResp = "";
            varXmlDocForBAM = new System.Xml.XmlDocument();
            varExpObj = new System.Exception();
            varIsException = false;
            varIsSoapExp = false;
            varException = "";
            varErrorMsg = "";
            varBuilder_MsgBody = new System.Text.StringBuilder();
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("8b4c3830-8680-4029-a120-4774ae3f4f31")]
            varXmlDoc = msgInXml;
            
            token = System.Guid.NewGuid();//Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceIn("SAPToSMAXAccount Orchestration started");
            ////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Received Message from SAP", token));
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("e8b62bb0-c91f-433f-9ac5-0ed10ad4a95d")]
            ////flowTracker = new Visy.SAP.ServiceMax.Helpers.OrchestrationESApiAccount.SAPToServiceMaxAccount();
            ////flowTracker.BeginSAPToServiceMaxAccountActivity();
            ////flowTracker.MsgReceivedTime = System.DateTime.Now.ToString();
            ////flowTracker.MessageData = varXmlDoc.OuterXml;
            ////flowTracker.CommitSAPToServiceMaxAccountActivity();
            
            ////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : BAM Tracking has Started , Activity ID :" + //flowTracker.ActivityID ,token));
            varDocNum = "";
            [Microsoft.XLANGs.BaseTypes.DesignerPosition("f03efdfb-9fa9-4eea-bf07-b99ae8ca47c4")]
            scope
            {
                body
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("eb676080-037e-42ee-96ce-6b8fc666648b")]
                    varRetryLimit = System.Convert.ToInt32(Visy.Middleware.Components.Utilities.DataLookupHelper.GetInterfaceLookupData("RetryLimit", "SAP.ServiceMax"));
                    varRetryInterval = System.Convert.ToInt32(Visy.Middleware.Components.Utilities.DataLookupHelper.GetInterfaceLookupData("RetryInterval", "SAP.ServiceMax"));
                    varRetryCount = 1;
                    
                    ////Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Login Orchestration Started " ,token));
                    
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("40072314-aa0b-4d56-a245-0e8566a5a36b")]
                    scope
                    {
                        body
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("92c8318b-7ef3-4919-a221-3ccb767cf26e")]
                            call Visy.Middleware.SAP.ServiceMax.Orchestrations.ServiceMaxLogin (token);
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("b4176921-f6aa-4794-b467-26ca953b4277")]
                            //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Call Orchestration completed; Control back to Parent Orch",token));
                            
                            varDocNum = xpath(msgInXml, "string(/*[local-name()='Receive' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='idocData' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='EDI_DC40' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='DOCNUM' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/Common/'])");
                            //flowTracker.ServerUrl = Visy.SAP.ServiceMax.Helpers.SessionDetails.ServerUrl;
                            //flowTracker.SessionID = Visy.SAP.ServiceMax.Helpers.SessionDetails.SessionId;
                            //flowTracker.ExternalId=xpath(msgInXml,"string(/*[local-name()='Receive' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='idocData' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Idoc/3/DEBMAS07/ZSM_DEBMAS/740/Receive']/*[local-name()='E2KNA1M005GRP' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='E2KNA1M005' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740']/*[local-name()='KUNNR' and namespace-uri()='http://Microsoft.LobServices.Sap/2007/03/Types/Idoc/3/DEBMAS07/ZSM_DEBMAS/740'])");
                            //flowTracker.IDOCDocNum= varDocNum;
                            //flowTracker.IntegrationPoint="SAP-SMAX_ACC";
                            //flowTracker.CommitSAPToServiceMaxAccountActivity();
                            varUpsertResp = "false";
                            
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("56c7d563-ddb1-4e9d-aa79-ed8a3976a39d")]
                            construct msgDEBMAS07
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("2fccb681-719c-4018-82a5-1da03df24ff7")]
                                msgDEBMAS07 = varXmlDoc;
                                
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : DEBMAS07 message has been constructed",token));
                            }
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("7a666c94-1a46-431d-9d16-a3847adfa57e")]
                            construct msgUpsertRequest
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("70439f53-34bf-4341-bb80-7c5fa2c6404f")]
                                transform (msgUpsertRequest.parameters) = Visy.Middleware.SAP.ServiceMax.Maps.DEBMAS07_To_Upsert (msgDEBMAS07);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("eb4b2f8e-2c21-4db6-b864-086b120eb7f6")]
                                msgUpsertRequest(WCF.SecurityMode)="Transport";
                                msgUpsertRequest(WCF.TransportClientCredentialType) = "None";
                                msgUpsertRequest(WCF.Action)="";
                                msgUpsertRequest(WCF.OutboundCustomHeaders) = "<headers><SessionHeader xmlns='urn:enterprise.soap.sforce.com'><sessionId>" + Visy.Middleware.SAP.ServiceMax.Components.SessionDetails.SessionId + "</sessionId></SessionHeader></headers>";
                                
                                Port_SendAccountUpsert(Microsoft.XLANGs.BaseTypes.Address) = Visy.Middleware.SAP.ServiceMax.Components.SessionDetails.ServerUrl;
                                Port_SendAccountUpsert(Microsoft.XLANGs.BaseTypes.TransportType)="WCF-BasicHttp";
                                
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Upsert Request message has been constructed",token));
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Session ID " + Visy.SAP.ServiceMax.Helpers.SessionDetails.SessionId,token));
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : URL" + Visy.SAP.ServiceMax.Helpers.SessionDetails.ServerUrl,token));
                                varXmlDocForBAM = msgUpsertRequest.parameters;
                            }
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("b4bcc4fe-d64f-4b1f-b3c1-54852ba43cba")]
                            construct msgUpsertResponse
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("2682ec9b-ebcd-447e-98b9-f160d6cf07e0")]
                                varXmlDoc = new System.Xml.XmlDocument();
                                varXmlDoc.LoadXml(@"<upsertResponse xmlns='urn:enterprise.soap.sforce.com'><result><created></created><id></id><success></success></result></upsertResponse>");
                                msgUpsertResponse.parameters=varXmlDoc;
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Upsert Response message has been constructed",token));
                                
                                varExpObj = new System.Exception();
                                varIsException = false;
                                varIsSoapExp = false;
                            }
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("355cd7b9-eb8d-433f-8c0a-a28536fb539d")]
                            while (varRetryCount <= varRetryLimit)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("aedcfbce-fe97-4bbc-9b69-7cb9d4680a8a")]
                                scope
                                {
                                    body
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("59c288fb-cc1c-4ff2-9e03-22a7ee4be1c5")]
                                        send (Port_SendAccountUpsert.Operation_SendUpsert, msgUpsertRequest);
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("77d203b8-8f09-4992-a927-cc1356ec8137")]
                                        receive (Port_SendAccountUpsert.Operation_SendUpsert, msgUpsertResponse);
                                    }
                                    exceptions
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("c237b9fd-651a-44bb-be32-1662d9bfdf61")]
                                        catch (System.Exception excp)
                                        {
                                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("080947a4-0126-4ec5-88c5-0cebaf2454d0")]
                                            varExpObj = new System.Exception();
                                            varExpObj = excp;
                                            varIsException = true;
                                            varIsSoapExp = false;
                                            System.Diagnostics.EventLog.WriteEntry("BizTalkApp", "SAP.ServiceMax: " + System.String.Format("{0} :Error in Transmitting the message.{1}; Retry count:"+varRetryCount.ToString(), token, excp.ToString()));
                                            
                                            //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} :Error in Transmitting the message.{1}; Retry count:"+varRetryCount.ToString(), token, excp.ToString()));
                                        }
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("1be4b2a0-9c99-4d61-a6a5-e35253aa091e")]
                                        catch (Port_SendAccountUpsert.Operation_SendUpsert.GenericSoapFault soapExc)
                                        {
                                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("83d00172-c218-4617-9016-bff9a8a5240a")]
                                            varException = xpath(soapExc, "string(/*[local-name()='Fault' and namespace-uri()='http://schemas.xmlsoap.org/soap/envelope/']/*[local-name()='faultstring' and namespace-uri()=''])");
                                            varExpObj = new System.Exception("ServiceMax returned an error message" + varException);
                                            varIsException = true;
                                            varIsSoapExp = true;
                                            
                                            System.Diagnostics.EventLog.WriteEntry("BizTalkApp", "SAP.ServiceMax: " + System.String.Format("{0} :A SOAP exception has occured within the First Upsert call. Error Description: "+ varException, token));
                                            
                                            //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} :A SOAP exception has occured within the First Upsert call. Error Description: "+ varException, token));
                                        }
                                    }
                                }
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("23566eab-9679-4933-83f0-600dd8b51571")]
                                varXmlDoc = new System.Xml.XmlDocument();
                                varXmlDoc = msgUpsertResponse.parameters;
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Upsert Response - {1}", token, varXmlDoc.InnerXml));
                                varUpsertResp = xpath(msgUpsertResponse.parameters, "string(/*[local-name()='upsertResponse' and namespace-uri()='urn:enterprise.soap.sforce.com']/*[local-name()='result' and namespace-uri()='urn:enterprise.soap.sforce.com']/*[local-name()='success' and namespace-uri()='urn:enterprise.soap.sforce.com'])");
                                //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Upsert Result :" + varUpsertResp, token));
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("a16b717a-0a81-4e1c-8b19-f441dbcb54ad")]
                                if ((varRetryCount >= varRetryLimit && varIsException == true))
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("5630ba82-ccfd-4515-824e-8c739f6bc2de")]
                                    varRetryCount = varRetryLimit + 1;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : An error occurred during the Upsert call. Exiting the loop",token));
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("320dff89-f5e3-4c9a-a5c1-83bd8fb0e83b")]
                                    throw varExpObj;
                                }
                                else if ((varIsException == false) && (varUpsertResp == "true"))
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("a59d0129-740b-4f7a-bb89-dd8420536071")]
                                    //flowTracker.IsError = "False";
                                    //flowTracker.IsRetrying = "False";
                                    //flowTracker.IsSentToServiceMax = "Success";
                                    //flowTracker.IsEmailSent = "False";
                                    //flowTracker.IsMessageSuspended = "False";
                                    //flowTracker.FirstReqSentToServiceMaxTime = System.DateTime.Now.ToString();
                                    //flowTracker.FirstServiceMaxRespMsg = varXmlDoc.OuterXml;
                                    //flowTracker.CommitSAPToServiceMaxAccountActivity();
                                    varRetryCount = varRetryLimit + 1;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : First Upsert successfully completed; Upsert response: " + varXmlDoc.OuterXml.ToString(), token));
                                    
                                }
                                else if (varUpsertResp == "false")
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("e6b87dcd-c8ee-4479-9117-8b8130e89521")]
                                    construct msgXmlDoc
                                    {
                                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("0307af40-127b-4e74-850e-1a1ffcef4135")]
                                        msgXmlDoc = msgUpsertResponse.parameters;
                                    }
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("3d0ca338-9450-4c09-a759-082a77d39040")]
                                    varRetryCount = varRetryLimit + 1;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Upsert returned a failure response. "+msgXmlDoc.OuterXml,token));
                                    varExpObj = new System.Exception(System.String.Format("ServiceMax returned an error message; <xmp>{0}</xmp>​", msgXmlDoc.OuterXml));
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("c39bc444-d9c9-4ec2-819b-9e3b868a8fe0")]
                                    throw varExpObj;
                                }
                                else if (varIsSoapExp == true)
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("fb1c1830-06f1-4856-bdfc-e7d4720902f3")]
                                    varRetryCount = varRetryLimit + 1;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : A SOAP exception occurred during the Upsert call. Exiting the loop",token));
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("1f322880-91ab-4d66-a0c3-60d950cae09e")]
                                    throw varExpObj;
                                }
                                else 
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("8d4d4d1e-3af8-4fb8-aeec-132516c5de8e")]
                                    varRetryCount = varRetryCount +1;
                                    varIsException =false;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Error in transmitting the upsert request; Waiting to retry",token));
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("76c4eaf5-d5c4-495a-88d0-e0d4beddc455")]
                                    delay new System.TimeSpan(0,varRetryInterval,0);
                                }
                            }
                        }
                        exceptions
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("321a392a-b823-4221-b77f-f2c37ae73534")]
                            catch (System.Exception AllExcp)
                            {
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("ca6364fb-f578-4ce6-9385-3ba07c9c224e")]
                                varErrorMsg = AllExcp.ToString();
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d28fb8f5-be52-429e-81f3-1427362067b3")]
                                construct msgFailedInterchange
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("8d03e80d-1bb8-4868-963b-441d0a21625b")]
                                    msgFailedInterchange = msgInXml;
                                    msgFailedInterchange(Visy.Middleware.SAP.ServiceMax.Schemas.ErrorDescription) = varErrorMsg;
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Sending Mesasage to Suspend Orchestration",token));
                                }
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("d81b9f9f-e18f-42ca-9c92-9c092fc6ee20")]
                                construct msgEmailException
                                {
                                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("dc4531e2-61df-4702-9879-ac5113f6dde4")]
                                    //Build HTML Message body
                                    varBuilder_MsgBody = new System.Text.StringBuilder();
                                    varBuilder_MsgBody.AppendLine("<html>");
                                    varBuilder_MsgBody.AppendLine("<head>");
                                    varBuilder_MsgBody.AppendLine("</head>");
                                    varBuilder_MsgBody.AppendLine("<body>");
                                    varBuilder_MsgBody.AppendLine("<p><B>SAPToSMAXAccount Orchestration Error</B></p>");
                                    
                                    varBuilder_MsgBody.AppendLine("<table>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>Date of Error:</td><td>");
                                    varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortDateString());
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>Time of Error:</td><td>");
                                    varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortTimeString());
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>Integration Point:</td><td>");
                                    varBuilder_MsgBody.AppendLine("SAP-SMAX_ACC");
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>Exception:</td><td>");
                                    varBuilder_MsgBody.AppendLine(varErrorMsg);
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>IDOC DocNum of Incoming Message:</td><td>");
                                    varBuilder_MsgBody.AppendLine(varDocNum);
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("<tr><td>Processing Server:</td><td>");
                                    varBuilder_MsgBody.AppendLine(System.Environment.MachineName);
                                    varBuilder_MsgBody.AppendLine("</td></tr>");
                                    
                                    varBuilder_MsgBody.AppendLine("</table>");
                                    
                                    varBuilder_MsgBody.AppendLine("</body>");
                                    varBuilder_MsgBody.AppendLine("</html>");
                                    
                                    //Set Email Properties
                                    msgEmailException.msgBody = new Visy.Middleware.SAP.ServiceMax.Components.RawString(varBuilder_MsgBody.ToString());
                                    msgEmailException.msgBody(Microsoft.XLANGs.BaseTypes.ContentType) = "text/html";
                                    msgEmailException(SMTP.Subject) = "SAPToSMAXAccount Orchestration failed in BizTalk Server: " + System.Environment.MachineName;
                                    
                                    msgEmailException(SMTP.From) = "webitadmin@visy.com.au";
                                    msgEmailException(SMTP.EmailBodyFileCharset) = "UTF-8";
                                    //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Created SMTP Mail Message",token));
                                    
                                    
                                    
                                    
                                }
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("c305bb9a-e6ee-4cc4-97f5-d3dfc6e01ab2")]
                                send (Port_SendMailForAccount.Operation_SendMailForAccount, msgEmailException);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("ce3dc925-36d9-40d3-b559-a7558e7cf250")]
                                send (Port_SendSusMsgForAccount.Operation_SendSusMsg, msgFailedInterchange);
                                [Microsoft.XLANGs.BaseTypes.DesignerPosition("0b98a603-5238-430a-b40f-5575f4330865")]
                                terminate "Service Max Part Update terminated due to error:" + AllExcp.Message;;
                            }
                        }
                    }
                }
                exceptions
                {
                    [Microsoft.XLANGs.BaseTypes.DesignerPosition("568d2f01-c49a-438e-9ea8-4f6085b37703")]
                    catch (System.Exception sysex)
                    {
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("c3bef3ef-32ed-4ced-8137-ed809330bd5e")]
                        varErrorMsg ="A General exception occurred in ServiceMax SAPToSMAXAccount Orchestration." + sysex.ToString();
                        //Microsoft.BizTalk.CAT.BestPractices.Framework.Instrumentation.TraceManager.WorkflowComponent.TraceInfo(System.String.Format("{0} : Error in Service Max.Exception :",token)+ varErrorMsg);
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("123b8787-7b24-4733-b85d-eca6855deaca")]
                        construct msgEmailException
                        {
                            [Microsoft.XLANGs.BaseTypes.DesignerPosition("f5a60ede-60b3-47a7-a2b2-dda7ff104443")]
                            
                            varBuilder_MsgBody = new System.Text.StringBuilder();
                            varBuilder_MsgBody.AppendLine("<html>");
                            varBuilder_MsgBody.AppendLine("<head>");
                            varBuilder_MsgBody.AppendLine("</head>");
                            varBuilder_MsgBody.AppendLine("<body>");
                            varBuilder_MsgBody.AppendLine("<p><B>SAPToSMAXAccount Orchestration Error</B></p>");
                            
                            varBuilder_MsgBody.AppendLine("<table>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>Date of Error:</td><td>");
                            varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortDateString());
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>Time of Error:</td><td>");
                            varBuilder_MsgBody.AppendLine(System.DateTime.Now.ToShortTimeString());
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>Integration Point:</td><td>");
                            varBuilder_MsgBody.AppendLine("SAP-SMAX_ACC");
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>Exception:</td><td>");
                            varBuilder_MsgBody.AppendLine(varErrorMsg);
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>IDOC DocNum of Incoming Message:</td><td>");
                            varBuilder_MsgBody.AppendLine(varDocNum);
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("<tr><td>Processing Server:</td><td>");
                            varBuilder_MsgBody.AppendLine(System.Environment.MachineName);
                            varBuilder_MsgBody.AppendLine("</td></tr>");
                            
                            varBuilder_MsgBody.AppendLine("</table>");
                            
                            varBuilder_MsgBody.AppendLine("</body>");
                            varBuilder_MsgBody.AppendLine("</html>");
                            
                            //Set Email Properties
                            msgEmailException.msgBody = new Visy.Middleware.SAP.ServiceMax.Components.RawString(varBuilder_MsgBody.ToString());
                            msgEmailException.msgBody(Microsoft.XLANGs.BaseTypes.ContentType) = "text/html";
                            msgEmailException(SMTP.Subject) = "SAPToSMAXAccount Orchestration failed in BizTalk Server: " + System.Environment.MachineName;
                            
                            msgEmailException(SMTP.From) = "bt2016@visy.com.au";
                            msgEmailException(SMTP.EmailBodyFileCharset) = "UTF-8";
                            
                        }
                        [Microsoft.XLANGs.BaseTypes.DesignerPosition("c29295d2-7c26-4ce3-a7a6-9df5dd4cd313")]
                        send (Port_SendMailForAccount.Operation_SendMailForAccount, msgEmailException);
                    }
                }
            }
        }
    }
}

